---
title: "R for Data Science"
---

# ggplot2

First steps

Los carros con motores grandes usan mas combustible que los peque√±os.

```{r}
library(ggplot2)
ggplot2::mpg
mpg

```

## Creating a ggplot

```{r}
ggplot(data=mpg) + geom_point(mapping = aes(x = displ, y =hwy, color = class))
```
La funcion ggplot() crea un sistema de coordenadas a la cual se pueden agregar capas.
El primer parametro de ggplot() es el conjunto de datos a usar en la grafica, esto crea una grafica vacia.

Se completa la grafica agregando uno o mas capas a ggplot(), la funcion geom_point() agrega una capa de puntos a la grafica, que crea una grafica de dispersion.

ggplot2 viene con muchas funciones y cada una agrega diferentes capas a una grafica. Cada funcion geom en ggplot2 toma un argumento de mapeo, el argumento de mapeo
define como se asignan las variables de su conjunto de datos a las propiedades visuales.
El parametro de mapeo es siempre conectado con `aes()`, y la x y y argumentos de `aes()` especifican que variables a mapear para los ejes x y y. 

## Una plantilla grafica
Se puede convertir este codigo para reusarlo como plantilla para hacer graficas con ggplot2. 

Para hacer una grafica, reemplace las secciones entre corchetes en el siguiente codigo con un conjunto de datos, una funcion geom o una coleccion de asignaciones:

```{r}
ggplot(data = <DATA>) +
    <GEOM_FUNCTION>(mapping = aes(<MAPPINGS>))
```

```{r}
ggplot(data = mpg)
```
```{r}
data
```
```{r}
ggplot(data = mpg) +
    geom_point(mapping = aes(x = hwy, y = cyl))
```

```{r}
ggplot(data = mpg) +
    geom_point(mapping = aes(x = displ, y = hwy, color = class))
```
```{r}
ggplot(data = mpg) +
    geom_point(mapping = aes(x = displ, y = hwy, size=class)) 
```
Con alpha se controla la transparencia de los puntos, hay que tomar en cuenta que ggplot solo tiene 6 formas de puntos. 
```{r}
ggplot(data = mpg) +
    geom_point(mapping = aes(x = displ, y = hwy, alpha=class)) 
```
Tambien se pueden usar formas para separar las clases.
```{r}
ggplot(data = mpg) +
    geom_point(mapping = aes(x = displ, y = hwy, shape=class)) 
```
Tambien se pueden poner propiedad como el color.
```{r}
ggplot(data = mpg) +
    geom_point(mapping = aes(x = displ, y = hwy), color = "blue") 
```
## Facets
Facets son una forma de dividir una grafica en multiples subgraficas basadas en una variable en el conjunto de datos. 
Para plotear una grafica con facetas, se agrega un facet_wrap() o facet_grid() a la grafica. 
```{r}
ggplot(data = mpg) +
    geom_point(mapping = aes(x = displ, y = hwy)) +
    facet_wrap(~ class, nrow = 2)
```
O facet_grid()
```{r}
ggplot(data = mpg) +
    geom_point(mapping = aes(x = displ, y = hwy)) +
    facet_grid(drv ~ cyl)
```
## Geometric Objects
ggplot2 tiene 6 funciones geometricas basicas que se pueden usar para crear graficas.
- geom_point() para graficas de dispersion
- geom_smooth() para lineas de regresion
- geom_bar() para graficas de barras
- geom_histogram() para histogramas
- geom_boxplot() para boxplots
- geom_tile() para mapas de calor

## Estetica
La estetica de una grafica se refiere a como se ven los elementos de la grafica.
La funcion aes() es usada para mapear variables a propiedades visuales. 
```{r}
ggplot(data = mpg) +
    geom_point(mapping = aes(x = displ, y = hwy, color = class))
```
En este caso, la estetica de color es mapeada a la variable class.

## Facets
Facets son una forma de dividir una grafica en multiples subgraficas basadas en una variable en el conjunto de datos.
```{r}
ggplot(data = mpg) +
    geom_point(mapping = aes(x = displ, y = hwy)) +
    facet_wrap(~ class, nrow = 2)
```
## Themes
Los temas controlan el aspecto de todos los elementos de la grafica, como los ejes, la leyenda y el fondo.
```{r}
ggplot(data = mpg) +
    geom_point(mapping = aes(x = displ, y = hwy)) +
    theme_bw()
```
Los tipos de temas son:
- theme_gray() el tema por defecto
- theme_bw
- theme_linedraw()
- theme_light()
- theme_minimal()
- theme_classic()
- theme_void()

## Saving a plot
Para guardar una grafica en un archivo, se puede usar la funcion ggsave().
```{r}
ggplot(data = mpg) +
    geom_point(mapping = aes(x = displ, y = hwy)) 

ggsave("myplot.png")
```

## Exercise
```{r}
ggplot(data = mpg) +
    geom_point(mapping = aes(x = displ, y = hwy, color = class)) +
    facet_wrap(~ class, nrow = 2)
```
Se pueden mostrar varias geometrias en la misma grafica.
```{r}
ggplot(data = mpg) +
    geom_point(mapping = aes(x = displ, y = hwy)) +
    geom_smooth(mapping = aes(x = displ, y = hwy))
```
Se puede plotear diferentes datos para cada capa y tipo de geometria.
```{r}
ggplot(data = mpg) +
    geom_point(mapping = aes(x = displ, y = hwy)) +
    geom_smooth(data = mpg, mapping = aes(x = displ, y = hwy))
```
## Transformacion estadistica.
```{r}
library(ggplot2)

ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut))
```
Muchos graficos como los diagramas de dispoersion trazan los valors brutos de su conjunto de datos, otros como los graficos de barras calculan nuevos valores para mostrar.
```{r}
ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut, y = ..prop.., group = 1))
```
El algoritmo usado para calcular nuevos valores para una grafica se llama stat, de statistical transformation.

Se pueden usar cada geom porque cada una tiene un stat por defecto. 

El stat identity y realiza ninguna transformacion, se usa para graficas de barras y diagramas de dispersion.

ggplot2 provee 20 stats diferentes, cada uno con diferentes argumentos, se pueden ver con ?stat_summary.
Tambien puedes colorear las barras.
```{r}
ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut, fill = cut))
```

Tambien existen ajustes de posicion para las barras.
```{r}

ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut, fill = cut), position = "dodge")

```
dodge posiciona las barras una al lado de la otra.
```{r}
ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut, fill = cut), position = "fill")
```

```{r}
ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut, fill = cut), position = "stack")
```
```{r}
ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut, fill = cut), position = "identity")

```
```{r}
ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut, fill = clarity), position = "dodge")
```
jitter es un ajuste de posicion que agrega un poco de ruido a los datos para que se puedan ver mejor.

```{r}
ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy), position = "jitter")
```
# Sistemas de coordenadas
ggplot2 soporta dos tipos de sistemas de coordenadas, coordenadas cartesianas y coordenadas polares.

## Coordenadas cartesianas
Las coordenadas cartesianas son el sistema de coordenadas mas comun, se usan para graficas de dispersion, lineas y barras.
```{r}
ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy))
```

## Coordenadas polares
Las coordenadas polares son usadas para graficas circulares, como los graficos de pastel y los diagramas de radar.
```{r}
ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = cut)) +
  coord_polar()
```
coord_flip invierte los ejes x y y.
```{r}
ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy)) +
  coord_flip()
```

coord_quickmap ajusta la relacion de aspecto de los ejes para que coincidan con la relacion de aspecto de los datos.
```{r}
nz <- map_data("nz")

ggplot(nz, aes(long, lat, group = group)) +
  geom_polygon(fill = "white", color = "black") +
  coord_fixed()
```




