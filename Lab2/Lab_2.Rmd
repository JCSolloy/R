---
title: "Laboratorio 2"
name: "Juan Carlos Solloy"
date: "29-06-2024"
---

En este laboratorio usaremos los datos de todos los vuelos que partieron de Nueva York en
2023. Estos datos se encuentran disponibles en el paquete nycflights23 de R. Los datos no
solo incluyen información de vuelos sino también de aviones, aeropuertos, aerolíneas y el clima
de vuelo.

A continuación se describen los datasets que se incluyen en este paquete:

● flights: Contiene información sobre todos los vuelos que salen de Nueva York.
● airports: Ofrece información sobre los aeropuertos, es decir: el nombre y la ubicación.
● planes: Contiene información sobre aviones particulares utilizados en vuelos.
● airlines: Brinda información sobre aerolíneas.
● weather: Nos da las condiciones climáticas de salida en Nueva York.
```{r}
library(nycflights23)
library(dplyr)
library(tidyverse)
library(tidyr)
```
Explore el contennido de cada dataset con la funcion view()
```{r}
View(flights)
View(airports)
View(planes)
View(airlines)
View(weather)
```


# 1 Inner-join
A continuacion se le presentan varios incisos los cuales debe trabajas por separado.

## 1.1 Conecte flights con planes.

```{r}
flights %>% 
  inner_join(planes, by = c("tailnum" = "tailnum"))
```

## 1.2 Conecte flights con airlines.
```{r}
flights %>% 
  inner_join(airlines, by = c("carrier" = "carrier"))
```
## 1.3 Conecte flights con airports(segun el esquema de arriba eexiste una doble relacion de airports hacia flights)
```{r}
flights %>% 
  inner_join(airports, by = c("origin" = "faa")) %>% 
  inner_join(airports, by = c("dest" = "faa"))
```
## 1.4 Conecte flights con weather.(segun el esquema de arriba, hay 5 variables que relacionan ambas tablas)
```{r}
flights %>% 
  inner_join(weather, by = c("year" = "year", "month" = "month", "day" = "day", "hour" = "hour", "origin" = "origin"))
```
# 2 Data manipulation

## 2.1 Utilice el verbo count en flights y  envie  como parametro las variables year, month,y day . Luego filtre n para que sea mayor a 800. Por ultimo ordene n con el verbo arrange y devuelva el resultado.
```{r}
flights %>% 
  count(year, month, day) %>% 
  filter(n > 800) %>% 
  arrange(n)
```
## 2.2 Utilice el concepto de selección por rango (aplicando el operador ":") para obtener las variables year hacia day. También agregue a esta selección hour, origin, dest, tailnum, carrier, arr_delay, dep_delay, por último almacene el resultado en la variable flights_selected.
```{r}
flights_selected <- flights %>% 
  select(year:day, hour, origin, dest, tailnum, carrier, arr_delay, dep_delay)
flights_selected
```
## 2.3 Utilice left_join para combinar airlines y flights_selected. Al obtener el resultado, utilice el verbo select para eliminar las columnas origin y dest (utilice el operador "-" para descartar estas columnas unicamente). Por ultimo agregue una nueva columna con el verbo mutate, asigne el nombre tot_delay y opere la suma de arr_delay y dep_delay.
```{r}
flights_selected %>% 
  left_join(airlines, by = c("carrier" = "carrier")) %>% 
  select(-origin, -dest) %>% 
  mutate(tot_delay = arr_delay + dep_delay)
```
## 2.4 Utilice inner_join para combinar flights y weather, luego agrupe por la variable  precip. Utilice summarieze para encontrar el promedio de la variable dep_delay (aplicando la funcion mean), asigne al promedio el nombre delay. Al utilizar la funcion mean agregue el parametro na.rm y asignele TRUE por defecto.

Luego agregue la funcion replace_na y apliquelo a la variable delay sustituyendo NA por cero. 
Por ultimo almacene el resultado en la variable precip_delay.
```{r}
precip_delay <- flights %>% 
  inner_join(weather, by = c("year" = "year", "month" = "month", "day" = "day", "hour" = "hour", "origin" = "origin")) %>% 
  group_by(precip) %>% 
  summarize(delay = mean(dep_delay, na.rm = TRUE)) %>% 
  replace_na(list(delay = 0))
precip_delay
```
## 2.5 Utilice la variable precip_delay para crear un grafico de puntos tomando de eje x la variable precip y para y la variable delay.
```{r}
precip_delay %>% 
  ggplot(aes(x = precip, y = delay)) + 
  geom_point()
```

## 2.6 Utilice flights y aplique filter tomando en cuenta la siguiente condicion: 
Que year sea igual a 2023:, que month sea igual a 6 y que day sea igual a 7.
Luego agrupe por la variable dest.
Despues utilice summarize para obtener el promedio de la variable arr_delay, establezca el parametro na.rm en TRUE y asigne al promedio el nombre delay .
Conecte el resultado anterior por medio de inner_join a la tabla airports y asignelo a la variable flights_airports.
```{r}
flights_airports <- flights %>% 
  filter(year == 2023, month == 6, day == 7) %>% 
  group_by(dest) %>% 
  summarize(delay = mean(arr_delay, na.rm = TRUE)) %>% 
  inner_join(airports, by = c("dest" = "faa"))
flights_airports
```
## 2.7 Utilice flights_airports para crear un grafico de puntos tomando de eje x la variable lon y para y la variable lat. 
Defina el color y el tamaño por medio de la variable delay.
El tamaño se establece por medio del parametro size.
```{r}
flights_airports %>% 
  ggplot(aes(x = lon, y = lat, color = delay, size = delay)) + 
  geom_point()
```
## 2.8 Utilice inner_join para combinar flights y planes. Agregue los sufijos _flights y _planes respectivamente.
Por ultimo utilice la funcion transmute para seleccionar las variables tailnum y manufacturer, pero ademas agregue la variable pi que almacena la suma de dep_delay y arr_delay, y luego divida por air_time.
```{r}
flights %>% 
  inner_join(planes, by = c("tailnum" = "tailnum"), suffix = c("_flights", "_planes")) %>% 
  transmute(tailnum, manufacturer, pi = (dep_delay + arr_delay) / air_time)
```




