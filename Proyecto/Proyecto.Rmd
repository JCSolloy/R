---
title: "Proyecto"
name: "Juan Carlos Solloy Xicón"
course: "Fundamentos de programación y scripting"
date: "03-07-2024"
---
# Descripción

La sepsis ocasiona en el mundo más de mil muertes cada día, muchos de estos pacientes adquieren la infección estando hospitalizados y constituye la complicación intrahospitalaria más frecuente. La infección de pacientes por las manos de contaminadas del personal de salud es una de las formas de diseminación de los agentes infecciosos. La higiene de las manos es el factor individual más importante para el control de las infecciones, es difícil entender que un hecho tan rutinario en la práctica de la medicina, como lavarse las manos previo a examinar a un paciente, haya causado tanta controversia en la época de 1800.

A principios de la década de 1840 se descubrió una enfermedad mortal que afectaba a las mujeres que acababan de dar a luz, cerca del 10% de las mujeres morían a causa de esta enfermedad y el origen provenía de las manos contaminadas del personal médico que atendía los partos.

En este proyecto, vamos analizar los datos que demuestran la importancia del lavado de manos, identificando anomalías en los procedimientos médicos.

# 1. Conociendo los datos

## 1.1 Cargue el paquete tidyverse
```{r}
library(tidyverse)
library(plotly)
library(dplyr)
```

## 1.2 Lea el archivo death_handwashing.csv usando read_csv y asígnelo a una variable.
```{r}
deaths_handwashing <- read_csv("deaths_handwashing.csv")
```
## 1.3 Imprima la variable del inciso 1.2
```{r}
deaths_handwashing
```
# 2 El alarmante número de muertes

La tabla anterior muestra el número de mujeres que dieron a luz durante los años 1841 a 1846 en una ciudad al noreste de Austria, en dos clínicas en particular. Notará que dar a luz era muy peligroso; un número alarmante de mujeres murió como resultado del parto. Vemos esto con mayor claridad si observamos la proporción de muertes con respecto al número de mujeres que dieron a luz.

## 2.1 Use mutate para agregar una nueva columna que se calculará como la proporción de muertes por número de nacimientos.
```{r}
deaths_handwashing <- deaths_handwashing %>%
  mutate(proportion_deaths = deaths / births)
```

## 2.2 Imprima el dataset con lanueva variable.
```{r}
deaths_handwashing %>%
  arrange(desc(proportion_deaths))
```
# 3 Muerte en las clínicas 
Si ahora graficamos la proporción de muertes en la clínica 1 como en la clínica 2, veremos un patrón curioso.

## 3.1 Utilice ggplot para hacer una gráfica lineal. Tome de referencia la columna creada en el inciso 2.1 (eje) versus la variable year (eje x).
```{r}
ggplot(deaths_handwashing, aes(x = year, y = proportion_deaths)) +
  geom_line()
```
## 3.2 Utilice la variable clinic para definir un color distinto en la estética de la gráfica.
```{r}
ggplot(deaths_handwashing, aes(x = year, y = proportion_deaths, color = clinic)) +
  geom_line()
```
## 3.3 Por último, imprima la gráfica y exponga su punto de vista.
```{r}
ggplotly(ggplot(deaths_handwashing, aes(x = year, y = proportion_deaths, color = clinic)) +
  geom_line() +
  labs(title = "Proporción de muertes en las clínicas 1 y 2",
       x = "Año",
       y = "Proporción de muertes")
    )
```

## Observaciones
- La proporción de muertes en la Clínica 1 es mucho más alta que en la Clínica 2, esto debido, como se menciona en la descripción, a que la enfermedad se propagaba por las manos contaminadas del personal médico, y en la clínica 1 había más estudiantes de medicina que en la clínica 2, quienes ademas de atender partos, también pasaban tiempo en las salas de autopsias examinando cadáveres.
- A partir del año 1842 la proporción de muertes en ambas clínicas empezó a disminuir de manera significativa.
- En el año 1845 la proporción de muertes tuvo un aumento en ambas clínicas.

# 4 Comienza el lavado de manos

¿Por qué la proporción de muertes es mucho más alta en la Clínica 1? 
La única diferencia en ambas clínicas era que muchos estudiantes de medicina trabajaban en la Clínica 1, mientras que en la Clínica 2 no había tantos. 
Otro dato interesante es que los médicos que atendían partos solo se encargaban de esa función, mientras que los estudiantes también pasaban tiempo en las salas de autopsias examinando cadáveres.

Se empezó a sospechar que algo en los cadáveres, propagado de las manos de los estudiantes de medicina, causaba la enfermedad. 
Entonces, en un intento desesperado por detener las altas tasas de mortalidad, se decretó: ¡Lávese las manos en todo momento!

## 4.1 Cargue los datos mensuales de la Clínica 1 para ver si el lavado de manos tuvo algún efecto, para esto lea el archivo deaths_clinic1.csv y asígnelo a una nueva variable.
```{r}
deaths_clinic1 <- read_csv("deaths_clinic_1.csv")
deaths_clinic1
```

## 4.2 Utilice ggplot para hacer una gráfica lineal. 
La gráfica tendrá la característica de ser dual (dos ejes Y). 
Para el eje X se utilizará la variable date y para Y1 y Y2, serán births y deaths respectivamente.
```{r}
ggplot(deaths_clinic1, aes(x = date)) +
  geom_line(aes(y = births, color = "Nacimientos")) +
  geom_line(aes(y = deaths, color = "Muertes")) +
  scale_y_continuous(sec.axis = sec_axis(~ . * 0.1, name = "Muertes"))
```
## 4.3 Utilice la funcion scale_y_continuous para agregar un título a cada eje Y.
```{r}
ggplot(deaths_clinic1, aes(x = date)) +
  geom_line(aes(y = births, color = "Nacimientos")) +
  geom_line(aes(y = deaths, color = "Muertes")) +
  scale_y_continuous(name = "Nacimientos", sec.axis = sec_axis(~ . * 0.1, name = "Muertes"))
```
## 4.4 Agregue un título al eje X y un título general a toda la gráfica.
```{r}
ggplot(deaths_clinic1, aes(x = date)) +
  geom_line(aes(y = births, color = "Nacimientos")) +
  geom_line(aes(y = deaths, color = "Muertes")) +
  scale_y_continuous(name = "Nacimientos", sec.axis = sec_axis(~ . * 0.1, name = "Muertes")) +
  labs(title = "Nacimientos y muertes en la Clínica 1",
       x = "Fecha")
```
## 4.5 Establezca color verde al comportamiento de la variable births y naranja para deaths. 
```{r}
ggplot(deaths_clinic1, aes(x = date)) +
  geom_line(aes(y = births, color = "Nacimientos")) +
  geom_line(aes(y = deaths, color = "Muertes")) +
  scale_y_continuous(name = "Nacimientos", sec.axis = sec_axis(~ . * 0.1, name = "Muertes")) +
  labs(title = "Nacimientos y muertes en la Clínica 1",
       x = "Fecha") +
  scale_color_manual(values = c("Nacimientos" = "green", "Muertes" = "orange"))
```
## 4.6 Imprima la gráfica resultante.
```{r}
ggplotly(ggplot(deaths_clinic1, aes(x = date)) +
  geom_line(aes(y = births, color = "Nacimientos")) +
  geom_line(aes(y = deaths, color = "Muertes")) +
  scale_y_continuous(name = "Nacimientos", sec.axis = sec_axis(~ . * 0.1, name = "Muertes")) +
  labs(title = "Nacimientos y muertes en la Clínica 1",
       x = "Fecha") +
  scale_color_manual(values = c("Nacimientos" = "green", "Muertes" = "orange"))
)
```

## 4.7 Construya una opinión con el resultado de la gráfica.

## Conclusiones
- La gráfica de nacimientos y muertes se puede observar que a partir del año 1847 la proporción de muertes disminuye de manera significativa, esto debido a que se hizo obligatorio el lavado de manos en la Clínica 1. 
- Ademas se puede observar que la proporción de nacimientos se mantiene constante a lo largo del tiempo, a partir del año 1848 se observa un aumento en la proporción de nacimientos, pero esto no afecta la proporción de muertes.

# 5 El efecto del lavado de manos. Analicemos la proporción de muertes a lo largo del tiempo.

Perspectiva lineal
## 5.1 Agregue una nueva columna a la variable creada en el inciso 4.1. 
Esta nueva columna se calculará como la proporción de muertes por número de nacimientos. Guarde este cambio en una nueva variable.
```{r}
deaths_clinic1 <- deaths_clinic1 %>%
  mutate(proportion_deaths = deaths / births)
```


## 5.2 Imprima las primeras filas del dataframe del punto anterior. Haga uso de la función head()
```{r}
head(deaths_clinic1)
```

## 5.3 Elabore una gráfica lineal utilizando la columna creada en el incico 5.1 (eje y) versus la colunma date (eje x).

```{r}
ggplot(deaths_clinic1, aes(x = date, y = proportion_deaths)) +
  geom_line()
```

## 5.4 Utilice la funcion labs para dar al eje x y al eje y una estética a las etiquetas.
```{r}
ggplot(deaths_clinic1, aes(x = date, y = proportion_deaths)) +
  geom_line() +
  labs(title = "Proporción de muertes en la Clínica 1",
       x = "Fecha",
       y = "Proporción de muertes")
```
## 5.5 Por último, imprima la gráfica y concluya.
```{r}
ggplotly(ggplot(deaths_clinic1, aes(x = date, y = proportion_deaths)) +
  geom_line() +
  labs(title = "Proporción de muertes en la Clínica 1",
       x = "Fecha",
       y = "Proporción de muertes")
)
```

Observaciones
- La proporción de muertes en la Clínica 1 disminuye de manera significativa a partir del año 1847, esto debido a que se hizo obligatorio el lavado de manos.
## 5.6 Use group_by para la variable year y summarise para encontrar la media tomando de referencia la variable del inciso 5.1. Guarde el resultado en una nueva variable.

```{r}
deaths_clinic1$year <- year(deaths_clinic1$date)
deaths_clinic1_yearly <- deaths_clinic1 %>%
  group_by(year) %>%
  summarise(mean_proportion_deaths = mean(proportion_deaths))
```

## 5.7 Utilice la variable creada en el inciso anterior para crear un gráfico de barras que muestre la media en cada año.

```{r}
ggplot(deaths_clinic1_yearly, aes(x = year, y = mean_proportion_deaths)) +
  geom_bar(stat = "identity")
```

## 5.8 Por último, imprima la grafica y concluya.
```{r}
ggplotly(ggplot(deaths_clinic1_yearly, aes(x = year, y = mean_proportion_deaths)) +
  geom_bar(stat = "identity") +
  labs(title = "Proporción de muertes promedio en la Clínica 1",
       x = "Año",
       y = "Proporción de muertes promedio")
)
```
# Conclusiones
- El promedio de muertes en la Clínica 1 disminuye de manera significativa a partir del año 1847, esto debido a que se hizo obligatorio el lavado de manos.

# 6 Los resultados del lavado de manos

A partir del año 1847 la proporción de muertes se reduce drásticamente y, sí, fue entonces cuando se hizo obligatorio el lavado de manos.
El efecto del lavado de manos se hace aún más claro si lo resaltamos en el gráfico.

# 6.1 Agregue una columna a la variable creada en el inciso 5.1, está columna será TRUE a partir del año en que se impuso el lavado de manos y FALSE para años anteriores. Guarde este cambio en una nueva variable.
```{r}
deaths_clinic1 <- deaths_clinic1 %>%
  mutate(handwashing_started = date >= "1847-01-01")
```

## 6.2 Construya una gráfica lineal tomando de referencia la variable con la proporción (muertes/nacimientos) para el eje y versus la variable date para el eje x. Haga que el color de la linea dependa de la columna creada en el inciso 6.1
```{r}
ggplot(deaths_clinic1, aes(x = date, y = proportion_deaths, color = handwashing_started)) +
  geom_line()
```
## 6.3 Utilice la función labs para dar al eje x y al eje y una estética a las etiquetas.
```{r}
ggplot(deaths_clinic1, aes(x = date, y = proportion_deaths, color = handwashing_started)) +
  geom_line() +
  labs(title = "Proporción de muertes en la Clínica 1",
       x = "Fecha",
       y = "Proporción de muertes")
```
## 6.4 Imprima la gráfica y concluya
```{r}
ggplotly(ggplot(deaths_clinic1, aes(x = date, y = proportion_deaths, color = handwashing_started)) +
  geom_line() +
  labs(title = "Proporción de muertes en la Clínica 1",
       x = "Fecha",
       y = "Proporción de muertes"))
```
# 7 ¿Más lavado de manos, menos muertes?

Nuevamente, las estadísticas muestran que lavarse las manos tuvo un efecto enorme. ¿Cuánto redujo la proporción mensual de muertes en promedio?

## 7.1 Tome de referencia la columna que se agregó en el inciso 6.1 y utilice la función groub_by para crear un agrupamiento.

```{r}
deaths_clinic1$month <- month(deaths_clinic1$date)
monthly <- deaths_clinic1 %>%
  group_by(handwashing_started, year(date), month(date)) %>%
  summarise(mean_proportion_deaths = mean(proportion_deaths))
```
## 7.2 En continuidad al inciso anterior, aplique summarise para calcular el promedio de la proporción de muertes antes y después de que se impusiera el lavado de manos. Tome de referencia la variable con la proporción (muertes/nacimientos).
```{r}
monthly_summary <- monthly %>%
  group_by(handwashing_started) %>%
  summarise(mean_proportion_deaths = mean(mean_proportion_deaths))
```

## 7.3 Asigne el resultado a una nueva variable e imprímala. 

```{r}
monthly_summary
```
## 7.4 Utlice ggplot para crear un boxplot que tome de referencia la columna creada en el inciso 6.1 (eje x) versus la variable de proporción (muertes/nacimientos).
```{r}
ggplot(monthly, aes(x = handwashing_started, y = mean_proportion_deaths)) +
  geom_boxplot()
```

## 7.5 Imprima la gráfica y concluya en función de los incisos 7.3 y 7.4.
```{r}
ggplot(monthly, aes(x = handwashing_started, y = mean_proportion_deaths)) +
  geom_boxplot()
```
# 8 Análisis estadístico de los datos de lavado de manos


¡Redujo la proporción de muertes en alrededor de 8 puntos porcentuales! Del 10% en promedio antes del lavado de manos a solo el 2% cuando se hizo cumplir el lavado de manos (que sigue siendo un número alto según los estándares modernos). Para tener una idea de la incertidumbre en torno a cuánto se reduce la mortalidad por lavarse las manos, podríamos observar un intervalo de confianza (aquí calculado mediante una prueba t).

Utilice la función t.test para calcular un intervalo de confianza del 95%. Los dos grupos que tenemos son proporción mensual de muertes antes y después de que comenzara el lavado de manos. Tome de referencia la columna con la proporción (muertes/nacimientos) y la columna creada en el inciso 6.1.
```{r}
t.test(monthly$mean_proportion_deaths ~ monthly$handwashing_started)
```
# Conclusiones
- El lavado de manos redujo la proporción de muertes en alrededor de 8 puntos porcentuales, del 10% en promedio antes del lavado de manos a solo el 2% cuando se hizo cumplir el lavado de manos.
- El intervalo de confianza del 95% para la diferencia en la proporción de muertes antes y después del lavado de manos es de -0.067 a -0.033. Lo cual indica que el lavado de manos redujo la proporción de muertes en un 6.7% a 3.3%.
- A pesar de que la proporción de muertes disminuyó de manera significativa, el 2% de muertes sigue siendo un número alto según los estándares modernos.
- El lavado de manos es una de las medidas más efectivas para prevenir la propagación de enfermedades infecciosas.

# 9 Análisis estadístico propio

## 9.1 Aplique funciones como filter, count, select o visualizaciones de tipo histograma o gráfica de puntos, que le permitan descubrir comportamientos o tendencias en los datos. No se limite a estas sugerencia, puede aplciar cualquier otro tipo de función.
## 9.2 Para cada análisis estadístico que proporcione concluya en función de los resultados obtenidos.

## Media de muertes en la Clínica 1 antes del lavado de manos
```{r}
deaths_clinic1 %>%
  filter(handwashing_started == FALSE) %>%
  summarise(mean_deaths = mean(deaths))
```
## Media de muertes en la Clínica 1 después del lavado de manos
```{r}
deaths_clinic1 %>%
  filter(handwashing_started == TRUE) %>%
  summarise(mean_deaths = mean(deaths))
```
### Conclusiones
- La media de muertes en la Clínica 1 antes del lavado de manos es de 10.5.
- La media de muertes en la Clínica 1 después del lavado de manos es de 2.1.
- El lavado de manos redujo la media de muertes en la Clínica 1 en 8.4.
- La media de muertes en la Clínica 1 después del lavado de manos es mucho más baja que antes del lavado de manos.

# Regresión lineal para predecir la proporción de muertes en la Clínica 1 si no se hubiera implementado el lavado de manos.

```{r}
deaths_clinic1_before <- deaths_clinic1 %>%
  filter(date < "1847-01-01")

lm(deaths_clinic1_before$proportion_deaths ~ deaths_clinic1_before$handwashing_started)
```
## Grafica del modelo de regresion lineal para predecir la proporción de muertes en la Clínica 1 si no se hubiera implementado el lavado de manos.

```{r}
ggplot(deaths_clinic1_before, aes(x = date, y = proportion_deaths)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE)
```
### Conclusión
- El modelo indica que si no se hubiera implementado el lavado de manos obligatorio la proporción de muertes hubiera ido en aumento.

# Modelo de regresión lineal para predecir la proporcion de muertes despues de implementar el lavado de manos.

```{r}
deaths_clinic1_after <- deaths_clinic1 %>%
  filter(date >= "1847-01-01")

lm(deaths_clinic1_after$proportion_deaths ~ deaths_clinic1_after$handwashing_started)
```

## Grafica el modelo de regresión lineal para predecir la proporción de muertes en la Clínica 1 después del lavado de manos.
```{r}
ggplot(deaths_clinic1_after, aes(x = date, y = proportion_deaths)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE)
```
### Conclusiones
- El modelo de regresión lineal para predecir la proporción de muertes después del lavado de manos a partir del año 1847 indica que la proporción de muertes disminuyó de manera significativa y seguirá disminuyendo en el futuro.

# Gráfica de puntos para comparar la proporción de muertes en la Clínica 1 antes y después del lavado de manos
```{r}
ggplot(deaths_clinic1, aes(x = date, y = proportion_deaths, color = handwashing_started)) +
  geom_point()
```

Gráfica de facet_wrap para comparar la proporción de muertes en la Clínica 1 antes y después del lavado de manos
```{r}
ggplotly(ggplot(deaths_clinic1, aes(x = date, y = proportion_deaths)) +
  geom_line() +
  facet_wrap(~ handwashing_started)+
  labs(title = "Proporción de muertes en la Clínica 1",
       x = "Fecha",
       y = "Proporción de muertes")+
  theme(legend.position = "none"))
```
